# Add this to src/core/bot.py after balance manager initialization (around line 255)

# Import the balance fix
from src.utils.balance_startup_fix import ensure_balance_loaded

# After this line:
# await self.balance_manager.initialize()

# Add these lines:
# Ensure balance is properly loaded at startup
if not await ensure_balance_loaded(self.balance_manager):
    self.logger.warning("[INIT] Failed to load initial balance - bot will retry during operation")
else:
    # Update capital flow with initial balance
    usdt_balance = await self.balance_manager.get_balance_for_asset('USDT')
    self.capital_flow['initial_usdt'] = usdt_balance
    self.capital_flow['current_usdt'] = usdt_balance
    self.logger.info(f"[INIT] Initial capital: ${usdt_balance:.2f} USDT")
